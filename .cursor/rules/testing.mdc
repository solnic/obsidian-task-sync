---
description: "Ensures test suite integrity: E2E/Playwright primacy, forbid fake/weakened/removed tests. Applies to tests and src."
globs: ["src/**/*", "tests/**/*"]
alwaysApply: false
---

# Testing & Integrity

- **E2E (Playwright) are PRIMARY** — Unit tests are only for simple utility functions
- **NEVER** mock Obsidian APIs (test via E2E)
- Write tests for assertions, not for avoiding import errors; failures must show `expected vs received` or similar, never missing imports

## Test Modification Rules
- **NEVER** remove, comment out, fake, or weaken tests to make the suite pass
- **NEVER** change expected behavior in a test without explicit team/stakeholder confirmation
- STOP and clarify if a test "feels" wrong

## Valid Test Edits
- Add stronger assertions
- Fix setup/teardown or correct clear bugs (not expectations!) — with analysis/confirmation

## Task Success Criteria
- Commit failing test (with `WIP - `), then the fix, then squash to one clean commit; all tests must pass

## Test Failure Handling
- Always understand why a test fails, not just "fix until green"
- Confirm with the team if you can't tell if the code or test is wrong

---

<!--
Origin: .augment/rules/4-test-integrity.md, .augment/rules/0-critical-summary.md
-->
