---
type: "always_apply"
---

# Current Project Context

Project: Obsidian Task Sync

# ðŸš¨ IMPLEMENTATION RULES - NEVER VIOLATE ðŸš¨

- There is a lot of very defensive code in this code base with complex error try/catch logic and awful fallbacks like `foo.?bar || 0` - such code is bad and you MUST NOT follow such patterns when writing new code or changing existing code.
- You MUST ALWAYS consult tmp/obsidian-api to ensure you're not reinventing the wheel

# ðŸš¨ TESTING RULES - NEVER VIOLATE ðŸš¨

- In e2e tests you must not use timeouts longer than 5 seconds
- You MUST ALWAYS see what test helpers are available and AVOID complex code in test scenarios
- Do not mock Obsidian APIs - any feature that relies on Obsidian APIs must be tested in e2e tests
- Do not use fixed timeouts in tests - instead use smart-waiting strategy. Implement helpers for smart-waiting if necessery.
- After you are done with all code changes you MUST run all tests via `npm test`
- `e2e` tests are the most important tests in this project as they test real interactions with the Obsidian API and the UI

# Running tests

- `npm test` to run unit and e2e tests
- `npm run test:e2e:headless` to run end-to-end tests only
- `npm run test:e2e:failed:headless` to rerun only tests that failed in previous run
- `npm run test:e2e:changed:headless` to run tests for changed files only

# Test workflow and failed test rerun

- All e2e tests use multiple reporters (verbose + JSON) and generate `e2e-test-results.json`
- Use `npm run test:e2e:failed:headless` to efficiently rerun only failed tests from previous run
- Script parses JSON results and uses `--testNamePattern` to target specific failed tests

# Debugging failing e2e tests

- Debug test artifacts can be found in e2e/debug
- E2e tests run at 1920x1080 resolution consistently

## UI and front-end

- `styles.css` is generated by the CSS build process. To change styles you must only edit CSS in `src/styles`

## References

- See tmp/obsidian-api/obsidian.d.ts for Obsidian API that you can leverage
- See tmp/obsidian-ghost-sync plugin for reference on testing setup, helpers and test running tasks
